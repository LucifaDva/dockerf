clusterby: swarm
master: buildimagetesttag-master-1
discovery: consul://101.200.173.242:8500/buildimagetesttag

machine:
    os: ubuntu-14.04-64

    cloud:
       aliyun:
          options: --aliyun-security-group-id buildimagetesttag --engine-install-url https://get.daocloud.io/docker/ --engine-insecure-registry 123.57.88.212:5000 --swarm-image 123.57.88.212:5000/liubin/swarm
          globaloptions: --native-ssh
          default: true
       virtualbox:
          options: --engine-insecure-registry 123.57.88.212:5000 --swarm-image 123.57.88.212:5000/library/swarm
          globaloptions: --native-ssh

    topology:
       # consulcluster:
       #    minnum: 3
       #    maxnum: 3
       #    cpu: 1
       #    memory: 1g
       #    disk:
       #       type: ssd
       #       capacity: 20g
       #    region: cn-beijing
       #    init: touch ~/hello
       #    driveropts:
       #    consul: false
       #    group: consulcluster

       -  group: buildimagetesttag-master
          minnum: 1
          maxnum: 1
          cpu: 2
          memory: 2g
          disk:
             type: ssd
             capacity: 20g
          region: cn-beijing
          init: touch ~/hello
          driveropts:
          consul: false

       -  group: buildimagetesttag-frontend
          minnum: 1
          maxnum: 1
          cpu: 1
          memory: 1g
          disk:
             type: ssd
             capacity: 10240m
          region: cn-beijing
          init: touch ~/hello
          driveropts:
          consul: false


container:
   topology:
       - group: buildimagetesttag-frontend
         port: 40000~50000:8080
         num: 1
         image: 123.57.88.212:5000/liubin/dao-2014-buildimagetesttag
         repo: https://github.com/luxuan/dao-2048.git
         prestop: touch ~/503  # execute some shell commands on the machine, not in container, before stop the service 
         poststart: touch ~/200
         restart: true
         servicediscover: webnginx
         machine: buildimagetesttag-frontend


consulcluster:
   server:
      service: weibo
      image: 123.57.88.212:5000/progrium/consul
      domain: weibo
      ips: 
         - 101.200.173.242
      nodes:
         # - consulcluster-1
         # - consulcluster-2
         # - consulcluster-3
      machine: consulcluster
   agent:
      image: 123.57.88.212:5000/progrium/consul
   registrator:
      image: 123.57.88.212:5000/progrium/registrator

